'use strict';

var isPlainObject = require('is-plain-obj');
var arrify = require('arrify');

var push = function push(obj, prop, value) {
	if (!obj[prop]) {
		obj[prop] = [];
	}

	obj[prop].push(value);
};

var insert = function insert(obj, prop, key, value) {
	if (!obj[prop]) {
		obj[prop] = {};
	}

	obj[prop][key] = value;
};

var passthroughOptions = ['stopEarly', 'unknown', '--'];

module.exports = function (options) {
	options = options || {};

	var result = {};

	passthroughOptions.forEach(function (key) {
		if (options[key]) {
			result[key] = options[key];
		}
	});

	Object.keys(options).forEach(function (key) {
		var value = options[key];

		if (key === 'arguments') {
			key = '_';
		}

		// If short form is used
		// convert it to long form
		// e.g. { 'name': 'string' }
		if (typeof value === 'string') {
			value = { type: value };
		}

		if (isPlainObject(value)) {
			var props = value;

			if (props.type) {
				var type = props.type;

				if (type === 'string') {
					push(result, 'string', key);
				}

				if (type === 'boolean') {
					push(result, 'boolean', key);
				}
			}

			var aliases = arrify(props.alias);

			aliases.forEach(function (alias) {
				insert(result, 'alias', alias, key);
			});

			if ({}.hasOwnProperty.call(props, 'default')) {
				insert(result, 'default', key, props.default);
			}
		}
	});

	return result;
};